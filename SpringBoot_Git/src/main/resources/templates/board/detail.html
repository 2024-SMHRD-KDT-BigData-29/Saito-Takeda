<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>게시글 상세</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <!-- 1. 게시글 타입 표시 -->
        <div class="mb-3">
            <strong>게시글 타입:</strong>
            <span th:if="${board.btype == 'room'}">룸메구해요</span>
            <span th:if="${board.btype == 'mate'}">방구해요</span>
        </div>

        <h1 th:text="${board.btitle}"></h1>
        <div class="mb-3">
            <strong>작성자:</strong> <span th:text="${board.userNickname}"></span> (<span th:text="${board.userMbti}"></span>, <span th:text="${board.userAge}"></span>세)
        </div>
        <div class="mb-3">
            <strong>작성일:</strong> <span th:text="${board.createdAt}"></span>
        </div>
        <div class="mb-3">
            <strong>조회수:</strong> <span th:text="${board.bviews}"></span>
        </div>
        <div class="mb-3">
            <strong>좋아요:</strong> <span th:text="${board.blikes}"></span>
        </div>
        <div class="mb-3">
            <strong>내용:</strong>
            <p th:text="${board.bcontent}"></p>
        </div>
        <div th:if="${board.bfile}" class="mb-3">
            <strong>첨부파일:</strong>
            <img th:src="${board.bfile}" alt="첨부파일" style="max-width: 300px;" />
        </div>

        <!-- 룸메 찾기 유형일 경우 -->
        <div th:if="${board.btype == 'room'}">
            <div class="mb-3">
                <strong>월세:</strong> <span th:text="${board.monthlyRent}"></span> 원
            </div>
            <div class="mb-3">
                <strong>관리비:</strong> <span th:text="${board.managementFee}"></span> 원
            </div>
            <div class="mb-3">
                <strong>집 유형:</strong> <span th:text="${board.houseType}"></span>
            </div>
            <div class="mb-3">
                <strong>주소:</strong> <span th:text="${board.address}"></span>
            </div>
            <div id="map" style="width: 100%; height: 400px;"></div>
        </div>

        <!-- 방 찾기 유형일 경우 -->
        <div th:if="${board.btype == 'mate'}">
            <div th:if="${board.userPhoto}" class="mb-3">
                <strong>자신의 사진:</strong>
                <img th:src="${board.userPhoto}" alt="자신의 사진" style="max-width: 300px;" />
            </div>
            <div class="mb-3">
                <strong>집 유형:</strong> <span th:text="${board.houseType}"></span>
            </div>
            <div class="mb-3">
                <strong>월 예산:</strong> <span th:text="${board.budget}"></span> 원
            </div>
            <div class="mb-3">
                <strong>희망 주소지:</strong> <span th:text="${board.desiredAddress}"></span>
            </div>
        </div>

        <!-- 4. 작성자 프로필 정보 표시 -->
        <div class="mb-3">
            <strong>작성자 프로필:</strong>
            <div th:if="${profileDTO != null}">
                <img th:src="${profileDTO.profileImg}" alt="프로필 사진" style="max-width: 100px;" />
                <p>MBTI: <span th:text="${profileDTO.userMbti}"></span></p>
                <p>자기소개: <span th:text="${profileDTO.userIntroduction}"></span></p>
                <p>생활 패턴: <span th:text="${profileDTO.lifestyle == 'morning' ? '아침형 인간' : '올빼미형 인간'}"></span></p>
            </div>
        </div>

        <!-- 5. 수정/삭제 버튼 (작성자 본인만 표시) -->
        <div th:if="${isOwner}">
            <a th:href="@{/board/edit/{bidx}(bidx=${board.bidx})}" class="btn btn-primary">수정</a>
            <form th:action="@{/board/delete/{bidx}(bidx=${board.bidx})}" method="post" style="display: inline;">
                <button type="submit" class="btn btn-danger">삭제</button>
            </form>
        </div>
        <form th:action="@{/board/favorite/{bidx}(bidx=${board.bidx})}" method="post" style="display: inline;">
            <button type="submit" class="btn btn-warning">찜하기/취소</button>
        </form>
        <a th:href="@{/board/list}" class="btn btn-secondary">목록으로</a>

        <!-- 2. 댓글 작성 폼 -->
		<div class="mb-3 mt-4">
		    <h3>댓글 작성</h3>
		    <form th:action="@{/comments/create/{bidx}(bidx=${board.bidx})}" method="post">
		        <textarea name="cmtContent" class="form-control" rows="3" placeholder="댓글을 입력하세요" required></textarea>
		        <button type="submit" class="btn btn-primary mt-2">댓글 작성</button>
		    </form>        
		</div>       
 		<!-- 댓글 목록 -->
        <div class="mb-3">
            <h3>댓글</h3>
			<div th:each="comment : ${comments}">
			    <div class="card mb-2">
			        <div class="card-body">
			            <p th:text="${comment.cmtContent}"></p>
			            <p><small>작성자: <span th:text="${comment.userEmail}"></span> | 작성일: <span th:text="${comment.createdAt}"></span></small></p>
			            <div th:if="${comment.userEmail == session.loginEmail}">
			                <form th:action="@{/comments/delete/{cmtIdx}(cmtIdx=${comment.cmtIdx})}" method="post" style="display: inline;">
			                    <input type="hidden" name="bidx" th:value="${board.bidx}" /> <!-- 게시글 ID 추가 -->
			                    <button type="submit" class="btn btn-danger btn-sm">삭제</button>
			                </form>
			            </div>
			        </div>
			    </div>
			</div>        
		</div>
    </div>
</body>
</html>